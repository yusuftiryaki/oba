{% extends "base.html" %}

{% block title %}Sistem Ayarlarƒ± - OBA Robot{% endblock %}

{% block extra_css %}
<style>
    .settings-section {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background: #f9f9f9;
    }
    .setting-item {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }
    .setting-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    .slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .slider-value {
        min-width: 60px;
        text-align: center;
        font-weight: bold;
    }
    .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
    }
    .status-online { background: #28a745; }
    .status-offline { background: #dc3545; }
    .status-warning { background: #ffc107; }
    .config-editor {
        font-family: 'Courier New', monospace;
        font-size: 12px;
    }
    .alert-info {
        background: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <h2>‚öôÔ∏è Sistem Ayarlarƒ±</h2>
            
            <!-- Robot Ayarlarƒ± -->
            <div class="settings-section">
                <h4>ü§ñ Robot Ayarlarƒ±</h4>
                
                <div class="setting-item">
                    <label><strong>Robot Adƒ±:</strong></label>
                    <input type="text" class="form-control" id="robotName" value="OBA-001" placeholder="Robot adƒ±">
                    <small class="text-muted">Robotunuz i√ßin √∂zel bir ad belirleyin</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Maksimum Hƒ±z:</strong></label>
                    <div class="slider-container">
                        <input type="range" class="form-control-range" id="maxSpeed" min="0.1" max="1.0" step="0.1" value="0.6">
                        <span class="slider-value" id="maxSpeedValue">0.6 m/s</span>
                    </div>
                    <small class="text-muted">Robotun maksimum hareket hƒ±zƒ±</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Tekerlek √áapƒ±:</strong></label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="wheelDiameter" value="0.15" step="0.01" min="0.1" max="0.3">
                        <div class="input-group-append">
                            <span class="input-group-text">metre</span>
                        </div>
                    </div>
                    <small class="text-muted">Odometri kalibrasyonu i√ßin tekerlek √ßapƒ±</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Robot Geni≈üliƒüi:</strong></label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="wheelBase" value="0.45" step="0.01" min="0.3" max="0.8">
                        <div class="input-group-append">
                            <span class="input-group-text">metre</span>
                        </div>
                    </div>
                    <small class="text-muted">Sol ve saƒü tekerlek arasƒ± mesafe</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Enkoder √á√∂z√ºn√ºrl√ºƒü√º:</strong></label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="encoderPPR" value="1024" min="512" max="4096">
                        <div class="input-group-append">
                            <span class="input-group-text">PPR</span>
                        </div>
                    </div>
                    <small class="text-muted">Pulse Per Revolution (devir ba≈üƒ±na nabƒ±z)</small>
                </div>
            </div>
            
            <!-- Bi√ßme Ayarlarƒ± -->
            <div class="settings-section">
                <h4>‚úÇÔ∏è Bi√ßme Ayarlarƒ±</h4>
                
                <div class="setting-item">
                    <label><strong>Varsayƒ±lan Bi√ßme Y√ºksekliƒüi:</strong></label>
                    <select class="form-control" id="defaultCuttingHeight">
                        <option value="1">Seviye 1 (En D√º≈ü√ºk - 2cm)</option>
                        <option value="2">Seviye 2 (3cm)</option>
                        <option value="3" selected>Seviye 3 (4cm)</option>
                        <option value="4">Seviye 4 (5cm)</option>
                        <option value="5">Seviye 5 (En Y√ºksek - 6cm)</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label><strong>Bi√ßme Motor RPM:</strong></label>
                    <div class="slider-container">
                        <input type="range" class="form-control-range" id="cuttingRPM" min="2000" max="4000" step="100" value="2800">
                        <span class="slider-value" id="cuttingRPMValue">2800 RPM</span>
                    </div>
                    <small class="text-muted">Bi√ßme motorunun devir hƒ±zƒ±</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Bi√ßme D√ºzeni:</strong></label>
                    <select class="form-control" id="defaultPattern">
                        <option value="boustrophedon" selected>Bi√ßerd√∂ver (Paralel √áizgiler)</option>
                        <option value="spiral">Spiral (ƒ∞√ßten Dƒ±≈üa)</option>
                        <option value="perimeter">√áevre √ñncelikli</option>
                        <option value="random">Rastgele</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label><strong>√áizgi Aralƒ±ƒüƒ±:</strong></label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="lineSpacing" value="0.4" step="0.1" min="0.2" max="0.8">
                        <div class="input-group-append">
                            <span class="input-group-text">metre</span>
                        </div>
                    </div>
                    <small class="text-muted">Paralel bi√ßme √ßizgileri arasƒ± mesafe</small>
                </div>
            </div>
            
            <!-- G√º√ß ve Batarya Ayarlarƒ± -->
            <div class="settings-section">
                <h4>üîã G√º√ß ve Batarya Ayarlarƒ±</h4>
                
                <div class="setting-item">
                    <label><strong>D√º≈ü√ºk Batarya E≈üiƒüi:</strong></label>
                    <div class="slider-container">
                        <input type="range" class="form-control-range" id="lowBatteryThreshold" min="10" max="40" step="5" value="20">
                        <span class="slider-value" id="lowBatteryValue">20%</span>
                    </div>
                    <small class="text-muted">Bu seviyenin altƒ±nda ≈üarj istasyonuna d√∂ner</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Kritik Batarya E≈üiƒüi:</strong></label>
                    <div class="slider-container">
                        <input type="range" class="form-control-range" id="criticalBatteryThreshold" min="5" max="15" step="1" value="5">
                        <span class="slider-value" id="criticalBatteryValue">5%</span>
                    </div>
                    <small class="text-muted">Bu seviyenin altƒ±nda acil durdurma</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Tam ≈ûarj E≈üiƒüi:</strong></label>
                    <div class="slider-container">
                        <input type="range" class="form-control-range" id="fullChargeThreshold" min="85" max="100" step="5" value="95">
                        <span class="slider-value" id="fullChargeValue">95%</span>
                    </div>
                    <small class="text-muted">Bu seviyede ≈üarj i≈ülemi biter</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>G√º√ß Tasarrufu Modu:</strong></label>
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="powerSaveMode">
                        <label class="custom-control-label" for="powerSaveMode">Aktif</label>
                    </div>
                    <small class="text-muted">D√º≈ü√ºk bataryada performansƒ± azaltƒ±r</small>
                </div>
            </div>
            
            <!-- Sens√∂r Ayarlarƒ± -->
            <div class="settings-section">
                <h4>üì° Sens√∂r Ayarlarƒ±</h4>
                
                <div class="setting-item">
                    <label><strong>IMU G√ºncellem Frekansƒ±:</strong></label>
                    <select class="form-control" id="imuFrequency">
                        <option value="10">10 Hz</option>
                        <option value="20" selected>20 Hz</option>
                        <option value="50">50 Hz</option>
                        <option value="100">100 Hz</option>
                    </select>
                    <small class="text-muted">Saniyede ka√ß kez IMU verisi okunur</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Enkoder Filtresi:</strong></label>
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="encoderFilter" checked>
                        <label class="custom-control-label" for="encoderFilter">Aktif</label>
                    </div>
                    <small class="text-muted">Enkoder verilerinde g√ºr√ºlt√º filtreleme</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Kalman Filtre Q Deƒüeri:</strong></label>
                    <div class="slider-container">
                        <input type="range" class="form-control-range" id="kalmanQ" min="0.001" max="0.1" step="0.001" value="0.01">
                        <span class="slider-value" id="kalmanQValue">0.01</span>
                    </div>
                    <small class="text-muted">S√ºre√ß g√ºr√ºlt√ºs√º kovaryansƒ± (d√º≈ü√ºk = daha az duyarlƒ±)</small>
                </div>
                
                <div class="setting-item">
                    <label><strong>Kalman Filtre R Deƒüeri:</strong></label>
                    <div class="slider-container">
                        <input type="range" class="form-control-range" id="kalmanR" min="0.1" max="10" step="0.1" value="1.0">
                        <span class="slider-value" id="kalmanRValue">1.0</span>
                    </div>
                    <small class="text-muted">√ñl√ß√ºm g√ºr√ºlt√ºs√º kovaryansƒ± (d√º≈ü√ºk = √∂l√ß√ºmlere daha √ßok g√ºven)</small>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- Sistem Durumu -->
            <div class="card">
                <div class="card-header">
                    <h5>üìä Sistem Durumu</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <span class="status-indicator status-online"></span>
                        <strong>Robot Durumu:</strong> Aktif
                    </div>
                    <div class="mb-3">
                        <span class="status-indicator status-online"></span>
                        <strong>Wi-Fi Baƒülantƒ±sƒ±:</strong> Baƒülƒ± (-45 dBm)
                    </div>
                    <div class="mb-3">
                        <span class="status-indicator status-warning"></span>
                        <strong>Son G√ºncelleme:</strong> 3 g√ºn √∂nce
                    </div>
                    <div class="mb-3">
                        <span class="status-indicator status-online"></span>
                        <strong>Sens√∂rler:</strong> T√ºm√º Aktif
                    </div>
                </div>
            </div>
            
            <!-- Hƒ±zlƒ± Eylemler -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5>‚ö° Hƒ±zlƒ± Eylemler</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary btn-block mb-2" onclick="calibrateSensors()">
                        üß≠ Sens√∂r Kalibrasyonu
                    </button>
                    <button class="btn btn-warning btn-block mb-2" onclick="resetOdometry()">
                        üìç Odometri Sƒ±fƒ±rla
                    </button>
                    <button class="btn btn-info btn-block mb-2" onclick="testMotors()">
                        ‚öôÔ∏è Motor Testi
                    </button>
                    <button class="btn btn-success btn-block mb-2" onclick="saveConfiguration()">
                        üíæ Ayarlarƒ± Kaydet
                    </button>
                    <button class="btn btn-secondary btn-block" onclick="resetToDefaults()">
                        üîÑ Varsayƒ±lanlara D√∂n
                    </button>
                </div>
            </div>
            
            <!-- Sistem Bilgileri -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5>‚ÑπÔ∏è Sistem Bilgileri</h5>
                </div>
                <div class="card-body">
                    <small>
                        <strong>Yazƒ±lƒ±m S√ºr√ºm√º:</strong> v1.0.0<br>
                        <strong>Donanƒ±m Revizyonu:</strong> Rev. 2.1<br>
                        <strong>Raspberry Pi:</strong> 4B 4GB<br>
                        <strong>Python S√ºr√ºm√º:</strong> 3.9.2<br>
                        <strong>√áalƒ±≈üma S√ºresi:</strong> 2d 14h 32m<br>
                        <strong>Toplam √áalƒ±≈üma:</strong> 125.5 saat<br>
                        <strong>Toplam Mesafe:</strong> 245.8 km
                    </small>
                </div>
            </div>
            
            <!-- Konfig√ºrasyon Dosyasƒ± -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5>üìù Geli≈ümi≈ü Ayarlar</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <small><strong>Uyarƒ±:</strong> Bu ayarlar deneyimli kullanƒ±cƒ±lar i√ßindir.</small>
                    </div>
                    <button class="btn btn-outline-primary btn-sm btn-block" onclick="showConfigEditor()">
                        üìÑ config.json D√ºzenle
                    </button>
                    <button class="btn btn-outline-secondary btn-sm btn-block mt-2" onclick="exportConfig()">
                        üì§ Konfig√ºrasyon Dƒ±≈üa Aktar
                    </button>
                    <button class="btn btn-outline-secondary btn-sm btn-block mt-1" onclick="importConfig()">
                        üì• Konfig√ºrasyon ƒ∞√ße Aktar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Konfig√ºrasyon Edit√∂r√º Modal -->
<div class="modal fade" id="configEditorModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üìù Konfig√ºrasyon Edit√∂r√º</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <strong>Dikkat:</strong> Yanlƒ±≈ü deƒüerler robot performansƒ±nƒ± olumsuz etkileyebilir.
                </div>
                <textarea class="form-control config-editor" id="configTextArea" rows="20" placeholder="Konfig√ºrasyon y√ºkleniyor..."></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    ‚ùå ƒ∞ptal
                </button>
                <button type="button" class="btn btn-warning" onclick="validateConfig()">
                    ‚úÖ Doƒürula
                </button>
                <button type="button" class="btn btn-primary" onclick="saveConfig()">
                    üíæ Kaydet
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Slider deƒüerlerini g√ºncelle
document.getElementById('maxSpeed').addEventListener('input', function() {
    document.getElementById('maxSpeedValue').textContent = this.value + ' m/s';
});

document.getElementById('cuttingRPM').addEventListener('input', function() {
    document.getElementById('cuttingRPMValue').textContent = this.value + ' RPM';
});

document.getElementById('lowBatteryThreshold').addEventListener('input', function() {
    document.getElementById('lowBatteryValue').textContent = this.value + '%';
});

document.getElementById('criticalBatteryThreshold').addEventListener('input', function() {
    document.getElementById('criticalBatteryValue').textContent = this.value + '%';
});

document.getElementById('fullChargeThreshold').addEventListener('input', function() {
    document.getElementById('fullChargeValue').textContent = this.value + '%';
});

document.getElementById('kalmanQ').addEventListener('input', function() {
    document.getElementById('kalmanQValue').textContent = parseFloat(this.value).toFixed(3);
});

document.getElementById('kalmanR').addEventListener('input', function() {
    document.getElementById('kalmanRValue').textContent = parseFloat(this.value).toFixed(1);
});

// Sens√∂r kalibrasyonu
function calibrateSensors() {
    if (confirm('Sens√∂r kalibrasyonu yakla≈üƒ±k 2 dakika s√ºrer. Ba≈ülatƒ±lsƒ±n mƒ±?')) {
        showNotification('üß≠ Sens√∂r kalibrasyonu ba≈ülatƒ±ldƒ±...', 'info');
        
        // WebSocket ile komut g√∂nder
        if (socket) {
            socket.emit('calibrate_sensors');
        }
        
        // Sim√ºle edilmi≈ü progress
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            if (progress <= 100) {
                showNotification(`üîÑ Kalibrasyon devam ediyor... %${progress}`, 'info');
            } else {
                clearInterval(interval);
                showNotification('‚úÖ Sens√∂r kalibrasyonu tamamlandƒ±!', 'success');
            }
        }, 2000);
    }
}

// Odometri sƒ±fƒ±rlama
function resetOdometry() {
    if (confirm('Odometri verilerini sƒ±fƒ±rlamak istediƒüinizden emin misiniz?')) {
        if (socket) {
            socket.emit('reset_odometry');
        }
        showNotification('üìç Odometri sƒ±fƒ±rlandƒ±', 'success');
    }
}

// Motor testi
function testMotors() {
    if (confirm('Motor testi ba≈ülatƒ±lsƒ±n mƒ±? Robot kƒ±sa s√ºreli hareket edecek.')) {
        showNotification('‚öôÔ∏è Motor testi ba≈ülatƒ±ldƒ±...', 'info');
        
        if (socket) {
            socket.emit('test_motors');
        }
        
        setTimeout(() => {
            showNotification('‚úÖ Motor testi tamamlandƒ±', 'success');
        }, 5000);
    }
}

// Ayarlarƒ± kaydetme
function saveConfiguration() {
    const config = {
        robot: {
            name: document.getElementById('robotName').value,
            max_speed: parseFloat(document.getElementById('maxSpeed').value),
            wheel_diameter: parseFloat(document.getElementById('wheelDiameter').value),
            wheel_base: parseFloat(document.getElementById('wheelBase').value),
            encoder_ppr: parseInt(document.getElementById('encoderPPR').value)
        },
        cutting: {
            default_height: parseInt(document.getElementById('defaultCuttingHeight').value),
            default_rpm: parseInt(document.getElementById('cuttingRPM').value),
            default_pattern: document.getElementById('defaultPattern').value,
            line_spacing: parseFloat(document.getElementById('lineSpacing').value)
        },
        battery: {
            low_threshold: parseInt(document.getElementById('lowBatteryThreshold').value),
            critical_threshold: parseInt(document.getElementById('criticalBatteryThreshold').value),
            full_threshold: parseInt(document.getElementById('fullChargeThreshold').value),
            power_save_mode: document.getElementById('powerSaveMode').checked
        },
        sensors: {
            imu_frequency: parseInt(document.getElementById('imuFrequency').value),
            encoder_filter: document.getElementById('encoderFilter').checked,
            kalman_q: parseFloat(document.getElementById('kalmanQ').value),
            kalman_r: parseFloat(document.getElementById('kalmanR').value)
        }
    };
    
    // WebSocket ile g√∂nder
    if (socket) {
        socket.emit('save_config', config);
    }
    
    showNotification('üíæ Ayarlar kaydedildi!', 'success');
}

// Varsayƒ±lan ayarlara d√∂nme
function resetToDefaults() {
    if (confirm('T√ºm ayarlarƒ± varsayƒ±lan deƒüerlere d√∂nd√ºrmek istediƒüinizden emin misiniz?')) {
        // Varsayƒ±lan deƒüerleri y√ºkle
        document.getElementById('robotName').value = 'OBA-001';
        document.getElementById('maxSpeed').value = 0.6;
        document.getElementById('maxSpeedValue').textContent = '0.6 m/s';
        document.getElementById('wheelDiameter').value = 0.15;
        document.getElementById('wheelBase').value = 0.45;
        document.getElementById('encoderPPR').value = 1024;
        
        document.getElementById('defaultCuttingHeight').value = 3;
        document.getElementById('cuttingRPM').value = 2800;
        document.getElementById('cuttingRPMValue').textContent = '2800 RPM';
        document.getElementById('defaultPattern').value = 'boustrophedon';
        document.getElementById('lineSpacing').value = 0.4;
        
        document.getElementById('lowBatteryThreshold').value = 20;
        document.getElementById('lowBatteryValue').textContent = '20%';
        document.getElementById('criticalBatteryThreshold').value = 5;
        document.getElementById('criticalBatteryValue').textContent = '5%';
        document.getElementById('fullChargeThreshold').value = 95;
        document.getElementById('fullChargeValue').textContent = '95%';
        document.getElementById('powerSaveMode').checked = false;
        
        document.getElementById('imuFrequency').value = 20;
        document.getElementById('encoderFilter').checked = true;
        document.getElementById('kalmanQ').value = 0.01;
        document.getElementById('kalmanQValue').textContent = '0.01';
        document.getElementById('kalmanR').value = 1.0;
        document.getElementById('kalmanRValue').textContent = '1.0';
        
        showNotification('üîÑ Varsayƒ±lan ayarlar y√ºklendi', 'warning');
    }
}

// Konfig√ºrasyon edit√∂r√ºn√º g√∂ster
function showConfigEditor() {
    // Mevcut konfig√ºrasyonu y√ºkle
    const configText = `{
  "robot": {
    "name": "OBA-001",
    "max_speed": 0.6,
    "wheel_diameter": 0.15,
    "wheel_base": 0.45,
    "encoder_ppr": 1024
  },
  "cutting": {
    "default_height": 3,
    "default_rpm": 2800,
    "default_pattern": "boustrophedon",
    "line_spacing": 0.4
  },
  "battery": {
    "low_threshold": 20,
    "critical_threshold": 5,
    "full_threshold": 95,
    "power_save_mode": false
  },
  "sensors": {
    "imu_frequency": 20,
    "encoder_filter": true,
    "kalman_q": 0.01,
    "kalman_r": 1.0
  },
  "docking": {
    "station_coords": [0.0, 0.0],
    "approach_distance": 5.0,
    "precision_distance": 0.5
  },
  "web": {
    "port": 5000,
    "debug": false,
    "camera_fps": 30
  }
}`;
    
    document.getElementById('configTextArea').value = configText;
    $('#configEditorModal').modal('show');
}

// Konfig√ºrasyon doƒürulama
function validateConfig() {
    const configText = document.getElementById('configTextArea').value;
    
    try {
        const config = JSON.parse(configText);
        showNotification('‚úÖ Konfig√ºrasyon ge√ßerli!', 'success');
        return true;
    } catch (error) {
        showNotification(`‚ùå JSON hatasƒ±: ${error.message}`, 'danger');
        return false;
    }
}

// Konfig√ºrasyon kaydetme
function saveConfig() {
    if (validateConfig()) {
        const configText = document.getElementById('configTextArea').value;
        
        if (socket) {
            socket.emit('save_raw_config', configText);
        }
        
        $('#configEditorModal').modal('hide');
        showNotification('üíæ Konfig√ºrasyon kaydedildi!', 'success');
    }
}

// Konfig√ºrasyon dƒ±≈üa aktarma
function exportConfig() {
    // Konfig√ºrasyonu dosya olarak indir
    const config = {
        robot_name: document.getElementById('robotName').value,
        timestamp: new Date().toISOString(),
        // ... diƒüer ayarlar
    };
    
    const dataStr = JSON.stringify(config, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `oba_config_${new Date().toISOString().slice(0,10)}.json`;
    link.click();
    
    showNotification('üì§ Konfig√ºrasyon dosyasƒ± indirildi', 'info');
}

// Konfig√ºrasyon i√ße aktarma
function importConfig() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    // Ayarlarƒ± form elemanlarƒ±na y√ºkle
                    // ... implementation
                    showNotification('üì• Konfig√ºrasyon y√ºklendi!', 'success');
                } catch (error) {
                    showNotification('‚ùå Ge√ßersiz konfig√ºrasyon dosyasƒ±', 'danger');
                }
            };
            reader.readAsText(file);
        }
    };
    
    input.click();
}

// Bildirim g√∂sterme
function showNotification(message, type = 'info') {
    const alertClass = `alert-${type}`;
    const notification = $(`
        <div class="alert ${alertClass} alert-dismissible fade show" role="alert" 
             style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
            ${message}
            <button type="button" class="close" data-dismiss="alert">
                <span>&times;</span>
            </button>
        </div>
    `);
    
    $('body').append(notification);
    
    setTimeout(() => {
        notification.alert('close');
    }, 5000);
}

// WebSocket olaylarƒ±
if (typeof socket !== 'undefined') {
    socket.on('config_saved', function(data) {
        showNotification('‚úÖ Konfig√ºrasyon ba≈üarƒ±yla kaydedildi', 'success');
    });
    
    socket.on('calibration_complete', function(data) {
        showNotification('üß≠ Sens√∂r kalibrasyonu tamamlandƒ±', 'success');
    });
    
    socket.on('test_complete', function(data) {
        showNotification(`‚úÖ ${data.test_type} testi tamamlandƒ±`, 'success');
    });
}

// Sayfa y√ºklendiƒüinde
$(document).ready(function() {
    console.log('Ayarlar sayfasƒ± y√ºklendi');
    
    // Mevcut ayarlarƒ± y√ºkle
    if (socket) {
        socket.emit('get_current_config');
    }
});
</script>
{% endblock %}
